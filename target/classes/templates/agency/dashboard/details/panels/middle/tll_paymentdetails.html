<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="ISO-8859-1"></meta>
    <title>Team Payment Details</title>
</head>
<body>
    <div id="layout-cibReport" th:fragment="tll_paymentdetails">
        <div class="box-header with-border">
            <h3 class="box-title" >Team Payment Details</h3>
        </div>
        <br/><br/>

        <div class="multi-line-broadcom-div">
            <ul id="info-tabs" class="nav nav-tabs">
                <li id="tab-payment" class="active">
                    <a data-toggle="tab"  href="#tab_pay" title="Team Leader Payment Details">Team Leader Payment Details</a>
                </li>
                <li id="tab-payment-dealer-wise">
                    <a data-toggle="tab" href="#dealer-wise-payment-view-loan" title="Dealer Wise payment details">Dealer Wise Payment Details</a>
                </li>
            </ul>
        </div>

        <div class="tab-content" id="payment_details-loan">
            <div role="tabpanel" class="tab-pane top-buffer active" id="tab_pay">
                <!--<form class="form-horizontal csi-view-form" id="card_payment_details">-->
                    <!--<div v-if="paymentSummary.length === 0">-->
                        <!--<p class="text-center">Loading... Please wait a minute</p>-->
                        <!--<div class="bouncing-loader">-->
                            <!--<div></div>-->
                            <!--<div></div>-->
                            <!--<div></div>-->
                        <!--</div>-->
                    <!--</div>-->
                    <!--<div v-else>-->
                        <!--<table class="table table-bordered custom_dt">-->
                            <!--<thead class="thead-light">-->
                                <!--<tr>-->
                                    <!--<th class="text-center">Narration</th>-->
                                    <!--<th class="text-center" colspan="2">Current Month</th>-->
                                    <!--<th class="text-center" colspan="2">Last Date</th>-->
                                <!--</tr>-->
                                <!--<tr>-->
                                    <!--<th>-</th>-->
                                    <!--<th class="text-center">Num of A/c</th>-->
                                    <!--<th class="text-center">Amount</th>-->
                                    <!--<th class="text-center">Num of A/c</th>-->
                                    <!--<th class="text-center">Amount</th>-->
                                <!--</tr>-->
                                <!--</thead>-->
                                <!--<tbody id="payment_status_card_tbody" class="tbl-row">-->
                                <!--<tr v-for="item in paymentSummary">-->
                                    <!--<td>{{item.narration}}</td>-->
                                    <!--<td>{{item.totalAc}}</td>-->
                                    <!--<td class="text-right">{{item.paidAmnt}}</td>-->
                                    <!--<td>{{item.totalAcToday}}</td>-->
                                    <!--<td class="text-right">{{item.paidAmntToday}}</td>-->
                                <!--</tr>-->
                            <!--</tbody>-->
                        <!--</table>-->
                    <!--</div>-->

                    <!--<div class="modal fade" id="modal-cardpayment-details">-->
                        <!--<div class="modal-dialog"  style="height: 100%; width: 80%; padding-right: 20px;">-->
                            <!--<div class="modal-content" style="height: 900px;">-->
                                <!--<div class="modal-header" style="text-align: center;">-->
                                    <!--<h4 class="modal-title">Card Payment Details</h4>-->
                                <!--</div>-->
                                <!--<div style="overflow: auto; max-height: 800px; padding: 20px; margin-bottom: 20px;">-->
                                    <!--<table class="table table-condensed table-hover table-bordered">-->
                                        <!--<thead class="thead-light">-->
                                            <!--<tr>-->
                                                <!--<th class="text-center">SL</th>-->
                                                <!--<th class="text-center">Payment Date</th>-->
                                                <!--<th class="text-center">Card NO</th>-->
                                                <!--<th class="text-center">Amount</th>-->
                                            <!--</tr>-->
                                        <!--</thead>-->
                                        <!--<tbody class="tbl-row">-->
                                        <!--&lt;!&ndash;<tr v-for="(payment,index) in paymentDetails">&ndash;&gt;-->
                                        <!--&lt;!&ndash;<td>{{index+1}}</td>&ndash;&gt;-->
                                        <!--&lt;!&ndash;<td>{{payment.paymentDate | dateFormat}}</td>&ndash;&gt;-->
                                        <!--&lt;!&ndash;<td><a :href="'/profile/loanprofile/search?account='+ payment.accountNo" target="_blank">{{payment.accountNo}}</a></td>&ndash;&gt;-->
                                        <!--&lt;!&ndash;<td>{{payment.amount | valueWithTwoPrecesion}}</td>&ndash;&gt;-->
                                        <!--&lt;!&ndash;</tr>&ndash;&gt;-->
                                        <!--</tbody>-->
                                    <!--</table>-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</form>-->

                <form class="form-horizontal csi-view-form" id="loan_payment_details">
                    <table class=" table   table-bordered custom_dt">
                        <thead class="thead-light">
                        <tr>
                            <th>Narration</th>
                            <th class="text-center" colspan="2">Current Month</th>
                            <th class="text-center" colspan="2">Last Date</th>
                        </tr>
                        <tr>
                            <th>-</th>
                            <th class="text-center">Num of A/c</th>
                            <th class="text-center">Amount</th>
                            <th class="text-center">Num of A/c</th>
                            <th class="text-center">Amount</th>
                        </tr>
                        </thead>
                        <tbody id="" class="tbl-row">
                        <tr v-for=" data in narration">
                            <td class="text-center"><a @click="showModal(data.narration)" style="cursor: pointer" data-toggle="modal" data-target="#modal-cardpayment-details">{{data.narration}}</a></td>
                            <td class="text-center">{{data.totalAc}}</td>
                            <td class="text-center">{{data.paidAmnt}}</td>
                            <td class="text-center">{{data.totalAcToday}}</td>
                            <td class="text-center">{{data.paidAmntToday}}</td>
                        </tr>
                        </tbody>
                    </table>

                    <div class="modal fade" id="modal-cardpayment-details">
                        <div class="modal-dialog"  style="height: 100%; width: 80%; padding-right: 20px;">
                            <div class="modal-content" style="height: 900px;">
                                <div class="modal-header" style="text-align: center;">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">Loan Payment Details</h4>
                                </div>
                                <div style="overflow: auto; max-height: 800px; padding: 20px; margin-bottom: 20px;">
                                    <table class="table customers table-condensed table-hover table-bordered">
                                        <thead class="thead-light">
                                        <th class="text-center">SL</th>
                                        <th class="text-center">Loan NO</th>
                                        <th class="text-center">Loan Name</th>
                                        <th class="text-center">Current Month Payment</th>
                                        <th class="text-center">Last Date Payment</th>
                                        <th class="text-center">Over Due</th>
                                        <th class="text-center">Outstanding</th>
                                        <th class="text-center">Dealer Name</th>
                                        <th class="text-center">Last Payment Date</th>
                                        </thead>
                                        <tbody class="tbl-row">
                                        <tr v-for="(payment,index) in paymentDetails">
                                            <td class="text-right">{{index+1}}</td>
                                            <td class="text-right"><a :href="'/profile/loanprofile/search?account='+ payment.accountNo" target="_blank">{{payment.accountNo}}</a></td>
                                            <td>{{payment.loanName}}</td>
                                            <td class="text-right">{{payment.payment | valueWithTwoPrecesion}}</td>
                                            <td class="text-right">{{payment.lastPayment | valueWithTwoPrecesion}}</td>
                                            <td class="text-right">{{payment.overDue}}</td>
                                            <td class="text-right">{{payment.outstanding}}</td>
                                            <td>{{payment.dealerName}}</td>
                                            <td class="text-right">{{payment.lastPaymentDate | dateFormat}}</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div role="tabpanel" class="tab-pane top-buffer" id="dealer-wise-payment-view-loan">
                <div class="form-group">
                    <label>Select Dealer(s): </label>
                    <div>
                        <multiselect v-model="selectedDealerList" placeholder="Choose one or more Dealer"
                                     :custom-label="nameWithPin" track-by="dealerPin" :options="dealerList"
                                     :multiple="true" :taggable="true"></multiselect>
                    </div>
                </div>
                <center><h5>Dealer Wise Payment Details</h5></center>
                <form class="form-horizontal csi-view-form">
                    <div style="overflow: auto;">
                        <table class="table table-bordered">
                            <thead class="thead-light">
                            <tr>
                                <th class="text-center" rowspan="3">Dealer name</th>
                                <th class="text-center" colspan="12">Current Month</th>
                                <th class="text-center" colspan="12">Last Date</th>
                            </tr>
                            <tr>
                                <th class="text-center" colspan="2" >Total Paid</th>
                                <th class="text-center" colspan="2">Unpaid</th>
                                <th class="text-center" colspan="2">Save</th>
                                <th class="text-center" colspan="2">Paid >= One EMI</th>
                                <th class="text-center" colspan="2">Paid but not save</th>
                                <th class="text-center" colspan="2">Paid in link account</th>
                                <th class="text-center" colspan="2">Total Paid</th>
                                <th class="text-center" colspan="2">Unpaid</th>
                                <th class="text-center" colspan="2">Save</th>
                                <th class="text-center" colspan="2">Paid >= One EMI</th>
                                <th class="text-center" colspan="2">Paid but not save</th>
                                <th class="text-center" colspan="2">Paid in link account</th>
                            </tr>
                            <tr>
                                <td class="text-center">Account</td>
                                <td class="text-center">collection Amount</td>
                                <td class="text-center">Account</td>
                                <td class="text-center">OS Amount</td>
                                <td class="text-center">Account</td>
                                <td class="text-center">OS Amount</td>
                                <td class="text-center">Account</td>
                                <td class="text-center">OS Amount</td>
                                <td class="text-center">Account</td>
                                <td class="text-center">OS Amount</td>
                                <td class="text-center">Account</td>
                                <td class="text-center">Paid Amount</td>
                                <td class="text-center">Account</td>
                                <td class="text-center">collection Amount</td>
                                <td class="text-center">Account</td>
                                <td class="text-center">OS Amount</td>
                                <td class="text-center">Account</td>
                                <td class="text-center">OS Amount</td>
                                <td class="text-center">Account</td>
                                <td class="text-center">OS Amount</td>
                                <td class="text-center">Account</td>
                                <td class="text-center">OS Amount</td>
                                <td class="text-center">Account</td>
                                <td class="text-center">Paid Amount</td>
                            </tr>
                            </thead>
                            <tbody class="tbl-row">
                            <tr v-for="item in filterDealerWiseFollowupSummary">
                                <td>{{item.dealerName}}</td>
                                <td>{{item.totalPaidAccount}}</td>
                                <td class="text-right">{{item.totalPaidCollectionAmount}}</td>
                                <td>{{item.unpaidAccount}}</td>
                                <td class="text-right">{{item.unpaidOutstanding}}</td>
                                <td>{{item.saveAccount}}</td>
                                <td class="text-right">{{item.saveOutstanding}}</td>
                                <td>0</td>
                                <td class="text-right">0</td>
                                <td>{{item.paidButNotSaveAccount}}</td>
                                <td class="text-right">{{item.paidButNotSaveOutstanding}}</td>
                                <td>0</td>
                                <td class="text-right">0</td>
                                <td>0</td>
                                <td class="text-right">0</td>
                                <td>0</td>
                                <td class="text-right">0</td>
                                <td>0</td>
                                <td class="text-right">0</td>
                                <td>0</td>
                                <td class="text-right">0</td>
                                <td>0</td>
                                <td class="text-right">0</td>
                                <td>0</td>
                                <td class="text-right">0</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </form>
            </div>

        </div>

        <script th:inline="javascript">
            /*<![CDATA[*/
                var dealerList = /*[[${dealerDetail}]]*/ [];
            /*]]>*/
            // $("#tab_payment_detail_teamLeader").click(function (event) {
            //     LoanPaymentDetails.getPaymentDetails();
            // });
        </script>
        <script>
            var LoanPaymentDetails = new Vue({
                el: '#payment_details-loan',
                data: {
                    selectedDealerList: [],
                    dealerList: [],

                    narration:[],
                    paymentDetails:[],
                    totalDetails:[],
                    saveDetails:[],
                    notSaveDetails:[],
                    oneEmiDetails:[],

                    paymentSummary: [],
                    dealerWisePaymentSummary:[],
                },
                computed:{
                    noDetails(){
                        return this.paymentSummary.length === 0;
                    },
                    selectedDealerName(){
                        return this.selectedDealerList.map(dealer => dealer.dealerPin);
                    },
                    filterDealerWiseFollowupSummary(){
                        return this.dealerWisePaymentSummary.filter(item => {
                            return this.selectedDealerName.includes(item.dealerName)
                        })
                    }
                },
                filters:{
                    dateFormat:function (value) {
                        var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                            "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                        ];
                        if(value != ''){
                            var date = new Date(value);
                            var day = date.getDate();
                            if(day < 10) day='0'+day;
                            return day +'-'+monthNames[date.getMonth()]+'-'+date.getFullYear().toString();
                        }else{
                            return "";
                        }
                    },
                    valueWithTwoPrecesion: function (value) {
                        if(value != '') return parseFloat(value).toFixed(2);
                        else return 0;
                    },
                },
                components:{
                    Multiselect: VueMultiselect.default
                },
                created(){
                    this.dealerList = dealerList;
                },
                methods:{
                    setTotalDetails: function (data) {
                        this.totalDetails = data;
                        // console.log(data);
                    },
                    setSaveDetails: function (data) {
                        this.saveDetails = data;
                        // console.log(data);
                    },
                    setNotSaveDetails: function (data) {
                        this.notSaveDetails = data;
                        // console.log(data);
                    },
                    setOneEmiDetails: function (data) {
                        this.oneEmiDetails = data;
                        // console.log(data);
                    },

                    showModal:function (item) {
                        console.log(item);
                        if(item == 'Total Paid')
                            this.paymentDetails = this.totalDetails;
                        else if(item == 'SAVE')
                            this.paymentDetails = this.saveDetails;
                        else if(item == 'Paid But Not SAVE')
                            this.paymentDetails = this.notSaveDetails;
                        else if(item == 'Paid >= One EMI')
                            this.paymentDetails = this.oneEmiDetails;
                        else this.paymentDetails = [];
                    },
                    addNewNarration: function(item){
                        this.narration.push(item);
                    },
                    nameWithPin({ dealerPin, dealerName}){
                        return `${dealerPin} - ${dealerName}`;
                    },
                    getPaymentDetails(){
                        let url = 'https://' + window.location.host + '/collection/dashboard/paymentStatus/loan';

                        this.$http.get(url, {credentials: true, headers: {'X-CSRF-TOKEN': window.csrfToken}})
                            .then(res => {
                                if (res.body) {
                                    this.paymentSummary = res.body.teamleaderWise;
                                    this.dealerWisePaymentSummary = res.body.dealerWise;
                                }
                            }).catch(err => {
                            console.log(err);
                        })
                    },
                }
            })
        </script>
    </div>
</body>
</html>
