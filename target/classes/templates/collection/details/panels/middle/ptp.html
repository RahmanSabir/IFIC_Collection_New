<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="ISO-8859-1"></meta>
    <title>Customer Complain</title>
</head>
<body>

<div id="layout-cibReport" th:fragment="ptp">
    <div class="csi-view-form-full-area csi-view-indtable">
        <div class="box-header with-border csi-view-box-header">
            <h3 class="box-title">PTP</h3>
            <button class=" btn btn-xs btn-primary pull-right" data-toggle="modal" data-target="#modal-ptp" >
                <i class="fa fa-plus-square"></i>
                Add More
            </button>
        </div>

        <div>
            <div class="modal fade" id="modal-ptp"  data-backdrop="static" data-keyboard="false">
                <div class="modal-dialog" style="width: 60%">
                    <div class="modal-content col-sm-12">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            </button>
                            <h3 >PTP</h3>
                        </div>
                        <form  method="post" class="form-horizontal" enctype="multipart/form-data">
                            <!--<input name="_csrf" value="" type="hidden">
                            <input name="customerId" value=""  type="hidden">
                            <div class="form-group col-sm-12">
                                <label class="col-sm-2 custom-details-lebel-left required">Dealer Name :</label>
                                <input type="text" name="dealerName" id="dealerName"  class="col-sm-4 custom-form-control" placeholder="Dealer Name" th:required="true"></input>
                                <label class="col-sm-2 custom-details-lebel-left required">Mobile Number :</label>
                                <input type="text" name="mobileNumber" id="mobileNumber" class="col-sm-4 custom-form-control" placeholder="Mobile Number" th:required="true"></input>
                            </div>
                            <div class="form-group col-sm-12">
                                <label class="col-sm-2 custom-details-lebel-left required">Complain Details :</label>
                                <textarea  type="text" class="col-sm-4 custom-form-control" placeholder="Complain Details" id="complainDetails"  name="complainDetails" th:required="true"></textarea>
                                <label class="col-sm-2 custom-details-lebel-left">Attachment :</label>
                                <input type="file" accept=".xls,.xlsx" class="col-sm-4 custom-form-control" placeholder="Attachment" name="file"/>
                            </div>-->
                            <div class="modal-footer text-center">
                                <button type="submit" id="saveComplain" class="btn btn-info">Save</button>
                                <button type="button" id="cardRefModalCancelBtn" class="btn btn-danger" data-dismiss="modal">Close</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="box-body">
            <div class="row">
                <!--new modal-->
                <div class="modal fade in" id="modal-customer-file"  data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog" style="width: 60%">
                        <div class="modal-content col-sm-12">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                </button>
                                <h3 >Customer File</h3>
                            </div>

                            <div>
                                <img id="imageId" src="">
                            </div>

                            <div class="modal-footer text-center">
                                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-horizontal csi-view-form" >
                <div id="customer_complain" style="overflow: auto; max-height: 400px;">
                    <table  name="ptp"
                            class=" table table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>Creator id</th>
                            <th>Create Date time</th>
                            <th>Amount</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Contact Details</th>
                            <th>Contact Location</th>
                            <th>Promisor Details</th>
                            <th>PTP Status</th>
                            <th>Remarks</th>
                        </tr>
                        </thead>
                        <tbody >

                        </tbody>
                    </table>
                </div>
            </div>
            <!--<script>
                $(document).ready(function () {
                    $('#customerComplainForm input[name="_csrf"]').val(csrfToken);
                    $('#customerComplainForm input[name="customerId"]').val(customerId)

                    function fetchData() {
                        $.getJSON('/collection/customer-complain/list?customerId='+customerId, function (json) {
                            fileData = json;
                            var tr = [];
                            for (var i = 0; i < json.length; i++){
                                tr.push('<tr>');
                                tr.push('<td>' + json[i].dealerName + '</td>');
                                tr.push('<td>' + json[i].mobileNumber + '</td>');
                                tr.push('<td>' + json[i].complainDetails + '</td>');
                                tr.push('<td><button id="file-event" data-index = "'+i+'" data-toggle="modal" data-target="#modal-customer-file">' + json[i].fileName + '</button></td>');
                                tr.push('<td>' + json[i].createdBy + '</td>');
                                tr.push('</tr>')
                            }
                            $('#customerComplainTable').append($(tr.join('')));
                        })
                    }

                    fetchData();


                    var customerComplain = {};

                    $('#customerComplainForm').on('submit', function (event) {
                        event.preventDefault();

                        // var complainObject = $(this).serialize();
                        var object = new FormData(this);
                        /*$.each($('input[name="files[]"]').get(0).files, function (i, file) {
                            object.append('file-'+i, file);
                        })*/

                        $.ajax({
                            type: "POST",
                            url: "/collection/customer-complain/create",
                            data: object,
                            enctype: 'multipart/form-data',
                            contentType: false,
                            processData: false,
                            success: function (data) {
                                swal("Success!", "Complain successfully Saved!", "success");
                                $('dealerName,mobileNumber,complainDetails').val('');
                                $('#modal-customer-complain').modal('toggle')
                                $('#complainTBody').html("");
                                fetchData();
                            },
                            error: function (error) {
                                console.log(error);
                            }
                        });
                    });


                    $("#complainTBody").delegate("#file-event","click", function () {
                        $.get("/collection/customer-complain/file-url?dmsFileId="+fileData[$(this).data('index')].dmsFileId, function (data) {
                            fileUrl = data;
                            $("#imageId").attr('src',fileUrl);
                            console.log(fileUrl);
                        })

                    });

                });
            </script>-->

        </div>
        <!--<script type="text/javascript" th:src="@{/customerprofileloan/guarantorinfo.js}"></script>-->
    </div>

</div>
</body>


</html>
