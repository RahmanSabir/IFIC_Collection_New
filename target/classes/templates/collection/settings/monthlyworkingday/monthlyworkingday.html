<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="card/layouts/main/main-layout">
<head>
    <meta charset="ISO-8859-1"></meta>
    <title>Monthly Working Day List</title>
</head>
<body>
<div layout:fragment="content" th:remove="tag">
    <div class="content-wrapper">
        <section class="content">
            <div class="row">
                <div class="col-md-12">
                    <div class="box">
                        <div class="box-header with-border" style="text-align: center;">
                            <h3 class="box-title">Monthly Working Day List</h3>
                        </div>

                        <style type="text/css">
                            .customers {
                                font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
                                border-collapse: collapse;
                                width: 100%;
                            }

                            .customers td, .customers th {
                                border: 1px solid #ddd;
                                padding: 8px;
                                text-align: center;
                                height: 50px;
                                cursor: pointer;
                            }

                            .selected {
                                background: #4CAF50;
                            }

                            .selectedcolor {
                                color: white;
                            }

                            /*.customers tr:nth-child(even){background-color: #f2f2f2;}*/

                            /*.customers tr:hover {background-color: #ddd;}*/

                            .customers th {
                                padding-top: 12px;
                                padding-bottom: 12px;
                                text-align: left;
                                background-color: #3c8dbc;
                                color: white;
                            }
                        </style>

                        <div class="box-body" id="monthly_working_day">
                            <a style="margin-bottom: 5px" @click="addMonthwiseWorking"
                               class="btn btn-primary btn-sm"><span class="glyphicon glyphicon-plus"> </span> Add
                                Monthwise working Day</a>
                            <table id="example" name="datatable-responsive"
                                   class="table table-condensed table-striped table-bordered">
                                <thead>
                                <tr>
                                    <th>Month Name</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="day in dayList">
                                    <td>{{day.name}}</td>
                                    <td>
                                        <a class="btn btn-info btn-xs" @click="showDetailsList(day)"><i class="fa fa-edit"></i>View</a>
                                        <a class="btn btn-primary btn-xs" v-if="day.name == currentMonthAndYear" @click="editDetailsList(day)"><i class="fa fa-edit"></i>Edit</a>
                                    </td>
                                </tr>
                                </tbody>
                            </table>

                            <div class="modal fade" id="modal-working-dashboard">
                                <div class="modal-dialog" style="height: 100%; width: 60%; padding-right: 20px;">
                                    <div class="modal-content">
                                        <div class="modal-header" style="text-align: center">
                                            <h4>{{currentMonthName}}, {{currentYear}}</h4>
                                        </div>

                                        <div class="modal-body">
                                            <div class="row">
                                                <div class="col-md-6 col-md-offset-3">
                                                    <table name="datatable-responsive"
                                                           class="table table-condensed customers">
                                                        <thead>
                                                        <tr>
                                                            <th>Sunday</th>
                                                            <th>Monday</th>
                                                            <th>Tuesday</th>
                                                            <th>Wednesday</th>
                                                            <th>Thursday</th>
                                                            <th>Friday</th>
                                                            <th>Saturday</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        <tr>
                                                            <td v-for="day in row1" @click="addWorkingDay(day)"
                                                                :class="{ selected: day.workingdays }">
                                                                <span v-if="day.daynumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingdays}" v-else>{{day.daynumber}}</span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td v-for="day in row2" @click="addWorkingDay(day)"
                                                                :class="{ selected: day.workingdays }">
                                                                <span v-if="day.daynumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingdays}" v-else>{{day.daynumber}}</span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td v-for="day in row3" @click="addWorkingDay(day)"
                                                                :class="{ selected: day.workingdays }">
                                                                <span v-if="day.daynumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingdays}" v-else>{{day.daynumber}}</span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td v-for="day in row4" @click="addWorkingDay(day)"
                                                                :class="{ selected: day.workingdays }">
                                                                <span v-if="day.daynumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingdays}" v-else>{{day.daynumber}}</span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td v-for="day in row5" @click="addWorkingDay(day)"
                                                                :class="{ selected: day.workingdays }">
                                                                <span v-if="day.daynumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingdays}" v-else>{{day.daynumber}}</span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td v-for="day in row6" @click="addWorkingDay(day)"
                                                                :class="{ selected: day.workingdays }">
                                                                <span v-if="day.daynumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingdays}" v-else>{{day.daynumber}}</span>
                                                            </td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer" style="display: flex">
                                            <div style="flex: 1">

                                            </div>
                                            <button type="button" @click="submitWorkingDays" class="btn btn-primary"
                                                     data-dismiss="modal">Submit
                                            </button>
                                            <div style="flex: 1">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modal fade" id="modal-working-dashboard-view">
                                <div class="modal-dialog" style="height: 100%; width: 60%; padding-right: 20px;">
                                    <div class="modal-content">
                                        <div class="modal-header" style="text-align: center">
                                            <h4>{{viewMonthAndYear}}</h4>
                                        </div>

                                        <div class="modal-body">
                                            <div class="row">
                                                <div class="col-md-6 col-md-offset-3">
                                                    <table name="datatable-responsive"
                                                           class="table table-condensed customers">
                                                        <thead>
                                                        <tr>
                                                            <th>Sunday</th>
                                                            <th>Monday</th>
                                                            <th>Tuesday</th>
                                                            <th>Wednesday</th>
                                                            <th>Thursday</th>
                                                            <th>Friday</th>
                                                            <th>Saturday</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        <tr>
                                                            <td v-for="day in viewRow1"
                                                                :class="{ selected: day.workingDay }">
                                                                <span v-if="day.dayNumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingDay}" v-else>{{day.dayNumber}}</span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td v-for="day in viewRow2"
                                                                :class="{ selected: day.workingDay }">
                                                                <span v-if="day.dayNumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingDay}" v-else>{{day.dayNumber}}</span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td v-for="day in viewRow3"
                                                                :class="{ selected: day.workingDay }">
                                                                <span v-if="day.dayNumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingDay}" v-else>{{day.dayNumber}}</span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td v-for="day in viewRow4"
                                                                :class="{ selected: day.workingDay }">
                                                                <span v-if="day.dayNumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingDay}" v-else>{{day.dayNumber}}</span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td v-for="day in viewRow5"
                                                                :class="{ selected: day.workingDay }">
                                                                <span v-if="day.dayNumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingDay}" v-else>{{day.dayNumber}}</span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td v-for="day in viewRow6"
                                                                :class="{ selected: day.workingDay }">
                                                                <span v-if="day.dayNumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingDay}" v-else>{{day.dayNumber}}</span>
                                                            </td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modal fade" id="modal-working-dashboard-edit">
                                <div class="modal-dialog" style="height: 100%; width: 60%; padding-right: 20px;">
                                    <div class="modal-content">
                                        <div class="modal-header" style="text-align: center">
                                            <h4>{{editRowName}}</h4>
                                        </div>

                                        <div class="modal-body">
                                            <div class="row">
                                                <div class="col-md-6 col-md-offset-3">
                                                    <table name="datatable-responsive"
                                                           class="table table-condensed customers">
                                                        <thead>
                                                        <tr>
                                                            <th>Sunday</th>
                                                            <th>Monday</th>
                                                            <th>Tuesday</th>
                                                            <th>Wednesday</th>
                                                            <th>Thursday</th>
                                                            <th>Friday</th>
                                                            <th>Saturday</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        <tr>
                                                            <td v-for="day in editRow1" @click="addWorkingDay(day)"
                                                                :class="{ selected: day.workingdays }">
                                                                <span v-if="day.daynumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingdays}" v-else>{{day.daynumber}}</span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td v-for="day in editRow2" @click="addWorkingDay(day)"
                                                                :class="{ selected: day.workingdays }">
                                                                <span v-if="day.daynumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingdays}" v-else>{{day.daynumber}}</span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td v-for="day in editRow3" @click="addWorkingDay(day)"
                                                                :class="{ selected: day.workingdays }">
                                                                <span v-if="day.daynumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingdays}" v-else>{{day.daynumber}}</span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td v-for="day in editRow4" @click="addWorkingDay(day)"
                                                                :class="{ selected: day.workingdays }">
                                                                <span v-if="day.daynumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingdays}" v-else>{{day.daynumber}}</span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td v-for="day in editRow5" @click="addWorkingDay(day)"
                                                                :class="{ selected: day.workingdays }">
                                                                <span v-if="day.daynumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingdays}" v-else>{{day.daynumber}}</span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td v-for="day in editRow6" @click="addWorkingDay(day)"
                                                                :class="{ selected: day.workingdays }">
                                                                <span v-if="day.daynumber == 0"></span>
                                                                <span :class="{selectedcolor: day.workingdays}" v-else>{{day.daynumber}}</span>
                                                            </td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer" style="display: flex">
                                            <div style="flex: 1">

                                            </div>
                                            <button type="button" @click="updateWorkingdays" class="btn btn-primary"
                                                    data-dismiss="modal">Update
                                            </button>
                                            <div style="flex: 1">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <script>
                            var monthNames = ["January", "February", "March", "April", "May", "June",
                                "July", "August", "September", "October", "November", "December"
                            ];
                            var daynames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

                            var monthlyWorkingDay = new Vue({
                                el: '#monthly_working_day',
                                data: {
                                    currentMonthName: '',
                                    currentYear: '',
                                    currentMonthDays: [],
                                    row1: new Array(),
                                    row2: new Array(),
                                    row3: new Array(),
                                    row4: new Array(),
                                    row5: new Array(),
                                    row6: new Array(),

                                    viewMonthAndYear:'',
                                    viewRow1: new Array(),
                                    viewRow2: new Array(),
                                    viewRow3: new Array(),
                                    viewRow4: new Array(),
                                    viewRow5: new Array(),
                                    viewRow6: new Array(),

                                    editRowName:'',
                                    eidtRowId:'',
                                    editRow1: new Array(),
                                    editRow2: new Array(),
                                    editRow3: new Array(),
                                    editRow4: new Array(),
                                    editRow5: new Array(),
                                    editRow6: new Array(),

                                    dayList:[],
                                },
                                computed:{
                                   currentMonthAndYear:function () {
                                       return monthNames[new Date().getMonth()] +','+new Date().getFullYear();
                                   }
                                },
                                created: function() {
                                    var host = window.location.host;
                                    this.$http.get('https://' + host + '/collection/settings/monthlyworking/daylist',
                                        {
                                            credentials: true, headers: {
                                                'X-CSRF-TOKEN': window.csrfToken,
                                            }
                                        }).then(res => {
                                        console.log(res);
                                        if (res.body) {
                                            this.dayList = res.body;
                                            console.log(this.dayList);
                                        }
                                    }).catch(err => {
                                        console.log(err);
                                    })
                            },
                            methods:{
                                editDetailsList:function(day){
                                    this.eidtRowId = day.id;
                                    this.editRowName = day.name;
                                    var list = day.detailsList;

                                    var editRow1 = list.slice(0, 7);
                                    var editRow2 = list.slice(7, 14);
                                    var editRow3 = list.slice(14, 21);
                                    var editRow4 = list.slice(21, 28);
                                    var editRow5 = list.slice(28, 35);
                                    var editRow6 = list.slice(35, 42);

                                    this.editRow1 = new Array();
                                    this.editRow2 = new Array();
                                    this.editRow3 = new Array();
                                    this.editRow4 = new Array();
                                    this.editRow5 = new Array();
                                    this.editRow6 = new Array();

                                    for(var i=0; i<editRow1.length; i++){
                                        var obj = {
                                            "id":editRow1[i].id,
                                            "daynumber": editRow1[i].dayNumber,
                                            "dayname": editRow1[i].dayNames,
                                            "workingdays": editRow1[i].workingDay,
                                        }
                                        this.editRow1.push(obj);
                                    }for(var i=0; i<editRow2.length; i++){
                                        var obj = {
                                            "id":editRow2[i].id,
                                            "daynumber": editRow2[i].dayNumber,
                                            "dayname": editRow2[i].dayNames,
                                            "workingdays": editRow2[i].workingDay,
                                        }
                                        this.editRow2.push(obj);
                                    }for(var i=0; i<editRow3.length; i++){
                                        var obj = {
                                            "id":editRow3[i].id,
                                            "daynumber": editRow3[i].dayNumber,
                                            "dayname": editRow3[i].dayNames,
                                            "workingdays": editRow3[i].workingDay,
                                        }
                                        this.editRow3.push(obj);
                                    }for(var i=0; i<editRow4.length; i++){
                                        var obj = {
                                            "id":editRow4[i].id,
                                            "daynumber": editRow4[i].dayNumber,
                                            "dayname": editRow4[i].dayNames,
                                            "workingdays": editRow4[i].workingDay,
                                        }
                                        this.editRow4.push(obj);
                                    }for(var i=0; i<editRow5.length; i++){
                                        var obj = {
                                            "id":editRow5[i].id,
                                            "daynumber": editRow5[i].dayNumber,
                                            "dayname": editRow5[i].dayNames,
                                            "workingdays": editRow5[i].workingDay,
                                        }
                                        this.editRow5.push(obj);
                                    }for(var i=0; i<editRow6.length; i++){
                                        var obj = {
                                            "id":editRow6[i].id,
                                            "daynumber": editRow6[i].dayNumber,
                                            "dayname": editRow6[i].dayNames,
                                            "workingdays": editRow6[i].workingDay,
                                        }
                                        this.editRow6.push(obj);
                                    }

                                    showMonthlyWorkingModalEdit();
                                },
                                showDetailsList:function (day){
                                    var list = day.detailsList;
                                    console.log(list[0]);
                                    this.viewMonthAndYear = day.name;

                                    this.viewRow1 = list.slice(0, 7);
                                    this.viewRow2 = list.slice(7, 14);
                                    this.viewRow3 = list.slice(14, 21);
                                    this.viewRow4 = list.slice(21, 28);
                                    this.viewRow5 = list.slice(28, 35);
                                    this.viewRow6 = list.slice(35, 42);

                                    showMonthlyWorkingModalView();
                                },

                                submitWorkingDays:function () {
                                    var payloadList = new Array();

                                    for (var i = 0; i < this.row1.length; i++) {
                                        payloadList.push(this.row1[i]);
                                    }
                                    for (var i = 0; i < this.row2.length; i++) {
                                        payloadList.push(this.row2[i]);
                                    }
                                    for (var i = 0; i < this.row3.length; i++) {
                                        payloadList.push(this.row3[i]);
                                    }
                                    for (var i = 0; i < this.row4.length; i++) {
                                        payloadList.push(this.row5[i]);
                                    }
                                    for (var i = 0; i < this.row5.length; i++) {
                                        payloadList.push(this.row5[i]);
                                    }
                                    for (var i = 0; i < this.row6.length; i++) {
                                        payloadList.push(this.row6[i]);
                                    }

                                    console.log(payloadList);

                                    var host = window.location.host;
                                    this.$http.post('https://' + host + '/collection/settings/monthlyworking/save', {
                                            name: this.currentMonthName + ',' + this.currentYear,
                                            payloads: payloadList,
                                        },
                                        {
                                            credentials: true, headers: {
                                                'X-CSRF-TOKEN': window.csrfToken,
                                            }
                                        }).then(res => {
                                        console.log(res);
                                        if (res.body) {
                                            this.dayList = res.body;
                                        }
                                    }).catch(err => {
                                        console.log(err);
                                    })
                                }
                                 ,

                                updateWorkingdays:function(day){
                                    var payloadList = new Array();

                                    for (var i = 0; i < this.editRow1.length; i++) {
                                        payloadList.push(this.editRow1[i]);
                                    }
                                    for (var i = 0; i < this.editRow2.length; i++) {
                                        payloadList.push(this.editRow2[i]);
                                    }
                                    for (var i = 0; i < this.editRow3.length; i++) {
                                        payloadList.push(this.editRow3[i]);
                                    }
                                    for (var i = 0; i < this.editRow4.length; i++) {
                                        payloadList.push(this.editRow5[i]);
                                    }
                                    for (var i = 0; i < this.editRow5.length; i++) {
                                        payloadList.push(this.editRow5[i]);
                                    }
                                    for (var i = 0; i < this.editRow6.length; i++) {
                                        payloadList.push(this.editRow6[i]);
                                    }
                                    var host = window.location.host;
                                    this.$http.post('https://' + host + '/collection/settings/monthlyworking/save', {
                                            id: this.eidtRowId,
                                            name: this.editRowName,
                                            payloads: payloadList,
                                        },
                                        {
                                            credentials: true, headers: {
                                                'X-CSRF-TOKEN': window.csrfToken,
                                            }
                                        }).then(res => {
                                        console.log(res);
                                        if (res.body) {
                                            this.dayList = res.body;
                                        }
                                    }).catch(err => {
                                        console.log(err);
                                    })
                                },

                                addWorkingDay:function (day) {
                                    if (day.daynumber != 0) day.workingdays = !day.workingdays;

                                }
                                ,
                                addMonthwiseWorking:function () {
                                    var date = new Date();
                                    this.currentMonthName = monthNames[date.getMonth()];
                                    this.currentYear = date.getFullYear();

                                    var y = date.getFullYear();
                                    var m = date.getMonth();
                                    var firstDay = new Date(y, m, 1);
                                    var lastDay = new Date(y, m + 1, 0);
                                    var startDate = firstDay.getDate();
                                    var lastDate = lastDay.getDate();
                                    var firstDayNumber = firstDay.getDay();
                                    var firstDayNumberNumeric = firstDay.getDay();
                                    var lastDayNumberNumeric = lastDay.getDay();
                                    var currentMonthArray = new Array();
                                    var finalCurrentMonthsArray = new Array();

                                    for (var i = startDate; i <= lastDate; i++) {
                                        var obj = {
                                            "daynumber": i,
                                            "dayname": daynames[firstDayNumber],
                                            "workingdays": false,
                                        }
                                        currentMonthArray.push(obj);
                                        firstDayNumber++;
                                        if (firstDayNumber == 7) firstDayNumber = 0;
                                    }
                                    var arrInsertFront = new Array()
                                    if (firstDayNumberNumeric != 0) {
                                        for (var i = firstDayNumberNumeric; i > 0; i--) {
                                            arrInsertFront.push({
                                                "daynumber": '0',
                                                "dayname": '',
                                                "workingdays": ''
                                            })
                                        }
                                    }

                                    if (arrInsertFront.length > 0)
                                        finalCurrentMonthsArray = arrInsertFront.concat(currentMonthArray);
                                    else finalCurrentMonthsArray = currentMonthArray;

                                    var arrInsertLast = new Array();
                                    if (lastDayNumberNumeric != 6) {
                                        for (var i = lastDayNumberNumeric; i < 6; i++) {
                                            arrInsertLast.push({
                                                "daynumber": '0',
                                                "dayname": '',
                                                "workingdays": ''
                                            })
                                        }
                                    }

                                    if (arrInsertLast.length > 0)
                                        finalCurrentMonthsArray = finalCurrentMonthsArray.concat(arrInsertLast);

                                    this.row1 = finalCurrentMonthsArray.slice(0, 7);
                                    this.row2 = finalCurrentMonthsArray.slice(7, 14);
                                    this.row3 = finalCurrentMonthsArray.slice(14, 21);
                                    this.row4 = finalCurrentMonthsArray.slice(21, 28);
                                    this.row5 = finalCurrentMonthsArray.slice(28, 35);
                                    this.row6 = finalCurrentMonthsArray.slice(35, 42);

                                    var itemForRow6 = new Array();
                                    if (this.row6.length == 0) {
                                        for (var i = 0; i < 6; i++) {
                                            itemForRow6.push({
                                                "daynumber": '0',
                                                "dayname": '',
                                                "workingdays": ''
                                            })
                                        }
                                        this.row6 = itemForRow6;
                                    }
                                    showMonthlyWorkingModal();
                                }
                            }
                            })
                        </script>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>
</body>
</html>