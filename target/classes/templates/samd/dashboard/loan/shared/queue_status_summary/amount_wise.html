<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="ISO-8859-1"></meta>
    <title>Amount Wise</title>
</head>
<body>
<div id="layout-cibReport" th:fragment="amount_wise_fragement">
    <div id="samd_amount_wise_queue_status_summary">
        <center><h5>Total</h5></center>
        <table class="table table-condensed table-bordered" style="overflow: auto;width: 100%">
            <thead class="thead-light">
                <th class="text-center">Dealer Pin</th>
                <th class="text-center">Product</th>
                <th class="text-center">DPD</th>
                <th class="text-center">Total</th>
                <th class="text-center">Touched</th>
                <th class="text-center">Untouched</th>
                <th class="text-center">Pending</th>
                <th class="text-center" colspan="4">PAR</th>
                <th class="text-center" colspan="4">NPL</th>
            </thead>
            <tbody id="dass_amount_data" class="tbl-row">
                <tr>
                    <td class="text-center"></td>
                    <td class="text-center"></td>
                    <td class="text-center"></td>
                    <td class="text-center" id="distribution_status_summary_total_total"></td>
                    <td class="text-center" id="touched_total"></td>
                    <td class="text-center" id="un_touched_total"></td>
                    <td class="text-center" id="pending_total"></td>
                    <td class="text-center text-bold">Release</td>
                    <td class="text-center text-bold">Remaining</td>
                    <td class="text-center text-bold">Queue</td>
                    <td class="text-center text-bold"title="Queue Next Date">Queue ND</td>
                    <td class="text-center text-bold">Release</td>
                    <td class="text-center text-bold">Remaining</td>
                    <td class="text-center text-bold">Queue</td>
                    <td class="text-center text-bold" title="Queue Next Date">Queue ND</td>
                </tr>
                <tr v-for="amount in amountWiseList">
                    <td>{{amount.dealerPin}}</td>
                    <td>{{amount.product}}</td>
                    <td>{{amount.dpd}}</td>
                    <td>{{amount.totalAmount | valueWithTwoPrecesion }}</td>
                    <td>{{amount.touchedAmount | valueWithTwoPrecesion }}</td>
                    <td>{{amount.unTouchedAmount | valueWithTwoPrecesion }}</td>
                    <td>{{amount.pendingAmount | valueWithTwoPrecesion }}</td>

                    <td>{{amount.parReleaseAmount | valueWithTwoPrecesion }}</td>
                    <td>{{amount.parRemainingAmount | valueWithTwoPrecesion }}</td>
                    <td>{{amount.parQueueAmount | valueWithTwoPrecesion }}</td>
                    <td>{{amount.parQueuendAmount | valueWithTwoPrecesion }}</td>

                    <td>{{amount.nplReleaseAmount | valueWithTwoPrecesion }}</td>
                    <td>{{amount.nplRemainingAmount | valueWithTwoPrecesion }}</td>
                    <td>{{amount.nplQueueAmount | valueWithTwoPrecesion }}</td>
                    <td>{{amount.nplQueuendAmount | valueWithTwoPrecesion }}</td>
                </tr>
            </tbody>
        </table>

        <br/>
    </div>
    <script th:inline="javascript">
        $("#tab-dass-samd").click(function () {
            $('.dass_amount_custom').remove();
            $('.dass_amount_per_custom').remove();

            var token = $("meta[name='_csrf']").attr("content");
            var header = $("meta[name='_csrf_header']").attr("content");

            var userPin= $("#globalUserPinForSummary").val();
            var unit=$("#globalUnitForSummary").val();
            var designation=$("#globalUserDesignationForSummary").val();
            var userId=$("#globalUserIdForSummary").val();

            if(unit=='Card') {

                $.ajax({
                    type:"GET",
                    url:"/collection/dashboard/samd/distribution/amountWise/card",
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader(header, token);
                    },
                    data:{
                        userPin:userPin,
                        unit:unit,
                        designation:designation,
                        userId:userId
                    },
                    success:function (json) {
                        console.log(json);
                        var data = JSON.stringify(json);
                        data = JSON.parse(data);

                        var total = 0;
                        var arr = new Array();
                        var ageCodeMap = new Map();


                        for(var j=0; j<data.length; j++){
                            if(!ageCodeMap.has(data[j].productAndDpd)){
                                ageCodeMap.set(data[j].productAndDpd, data[j]);
                            }else{
                                var newVar = ageCodeMap.get(data[j].productAndDpd);

                                newVar.numberPerDpd += data[j].numberPerDpd;
                                newVar.touchedNumber += data[j].touchedNumber;
                                newVar.unTouchedNumber += data[j].unTouchedNumber;
                                newVar.totalPending += data[j].totalPending;
                                newVar.totalParRel += data[j].totalParRel;
                                newVar.totalParRelRem += data[j].totalParRelRem;
                                newVar.totalParQ += data[j].totalParQ;
                                newVar.totalNplRel += data[j].totalNplRel;
                                newVar.totalNplRem += data[j].totalNplRem;
                                newVar.totalNplQ += data[j].totalNplQ;
                            }
                        }

                        for(const [key, value] of ageCodeMap.entries()) {
                            var data = value;
                            var tr = '';
                            tr += '<tr class="dass_amount_custom">\n' +
                                '                        <td class="text-right">'+data.productAndDpd+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.numberPerDpd*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.touchedNumber*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.unTouchedNumber*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.totalPending*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.totalParRel*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.totalParRelRem*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.totalParQ*100)/100+'</td>\n' +
                                '                        <td class="text-right"></td>\n' +
                                '                        <td class="text-right">'+Math.round(data.totalNplRel*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.totalNplRem*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.totalNplQ*100)/100+'</td>\n' +
                                '                        <td class="text-right"></td>\n' +
                                '                    </tr>';
                            $('#dass_amount_data').append(tr);
                            tr = '';
                            tr += '<tr class="dass_amount_custom">\n' +
                                '                        <td class="text-right">'+data.productAndDpd+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.totalPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.touchedPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.unTouchedPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.pendingPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.parRelPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.parRelRemPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.parQPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right"></td>\n' +
                                '                        <td class="text-right">'+Math.round(data.nplRelPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.nplRemPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.nplQPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right"></td>\n' +
                                '                    </tr>';

                            $('#dass_amount_per_data').append(tr);

                        }
                    }
                }).done(function(){

                });


            }else if(unit == 'Loan') {

                $.ajax({
                    type:"GET",
                    url:"/collection/samd/loan/dashboard/distribution/amountWise",
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader(header, token);
                    },
                    data:{
                        userPin:userPin,
                        unit:"SAM",
                        designation:designation,
                        userId:userId
                    },
                    success:function (json) {

                        var data = JSON.stringify(json);
                        data = JSON.parse(data);

                        var total = 0;
                        var arr = new Array();
                        var ageCodeMap = new Map();


                        for(var j=0; j<data.length; j++){
                            if(!ageCodeMap.has(data[j].productAndDpd)){
                                ageCodeMap.set(data[j].productAndDpd, data[j]);
                            }else{
                                var newVar = ageCodeMap.get(data[j].productAndDpd);

                                newVar.numberPerDpd += data[j].numberPerDpd;
                                newVar.touchedNumber += data[j].touchedNumber;
                                newVar.unTouchedNumber += data[j].unTouchedNumber;
                                newVar.totalPending += data[j].totalPending;
                                newVar.totalParRel += data[j].totalParRel;
                                newVar.totalParRelRem += data[j].totalParRelRem;
                                newVar.totalParQ += data[j].totalParQ;
                                newVar.totalNplRel += data[j].totalNplRel;
                                newVar.totalNplRem += data[j].totalNplRem;
                                newVar.totalNplQ += data[j].totalNplQ;
                            }
                        }

                        for(const [key, value] of ageCodeMap.entries()) {
                            var data = value;
                            var tr = '';

                            tr += '<tr class="dass_amount_custom">\n' +
                                '                        <td class="text-right">'+data.productAndDpd+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.numberPerDpd*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.touchedNumber*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.unTouchedNumber*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.totalPending*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.totalParRel*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.totalParRelRem*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.totalParQ*100)/100+'</td>\n' +
                                '                        <td class="text-right"></td>\n' +
                                '                        <td class="text-right">'+Math.round(data.totalNplRel*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.totalNplRem*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.totalNplQ*100)/100+'</td>\n' +
                                '                        <td class="text-right"></td>\n' +
                                '                    </tr>';

                            $('#dass_amount_data').append(tr);
                            tr = '';
                            tr += '<tr class="dass_amount_custom">\n' +
                                '                        <td class="text-right">'+data.productAndDpd+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.totalPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.touchedPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.unTouchedPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.pendingPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.parRelPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.parRelRemPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.parQPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right"></td>\n' +
                                '                        <td class="text-right">'+Math.round(data.nplRelPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.nplRemPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right">'+Math.round(data.nplQPerc*100)/100+'</td>\n' +
                                '                        <td class="text-right"></td>\n' +
                                '                    </tr>';

                            $('#dass_amount_per_data').append(tr);
                        }
                    }
                }).done(function(){

                });
            }

        });
    </script>
    <script>
        var samd_amount_wise_queue_status_summary = new Vue({
            el:'#samd_amount_wise_queue_status_summary',
            data:{
              amountWiseList : [],
            },
            filters:{
              valueWithTwoPrecesion(value){
                  return value.toFixed(2);
              }
            },
            methods:{
                getAmountWiseData(){
                    /*let userPin= $("#globalUserPinForSummary").val();
                    let unit= 'SAM' //$("#globalUnitForSummary").val();
                    let designation=$("#globalUserDesignationForSummary").val();
                    let userId=$("#globalUserIdForSummary").val();

                    var host = window.location.host;
                    var url = window.location.protocol + "//" + host + "/collection/dashboard/samd/distribution/amountWise?userPin=" + userPin + "&unit=" + unit + "&designation=" + designation + "&userId=" + userId;
                    this.$http.get(url,
                        {credentials : true, headers:{
                                'X-CSRF-TOKEN' : window.csrfToken,
                            }}).then(res => {
                        console.log(res);
                        if(res.body){
                            this.amountWiseList = res.body;
                            if(typeof summary_details !== 'undefined')
                                summary_details.getDataFromJQuery(this.amountWiseList);
                        }
                    }).catch(err => {
                        console.log(err);
                    })
*/
                }
            }
        })
    </script>
</div>

</body>


</html>

