<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="legal/layouts/main/main-layout">
<head>
    <meta charset="UTF-8">
    <title th:text="${reportTitle }"></title>
    <link rel="stylesheet" href="/css/datatables-utils/buttons.dataTables.min.css">
</head>
<body>
<div layout:fragment="content">
    <div class="content-wrapper">
        <div class="content">
            <div class="row">
                <div class="col-xs-12" id="pending-court-cases-app">
                    <div class="box box-info">
                        <div class="box-header with-border text-center">
                            <div class="box-title" th:text="${reportTitle}"></div>
                        </div>

                        <div class="box-body">
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="form-horizontal padding-top-20">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="col-sm-4 padding-top-6 text-right">Month</label>
                                                <div class="col-sm-8">
                                                    <input name="month" v-model="selectedMonth" type="month" class="form-control" style="border-radius: 5px">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-5 text-right">
                                            <button type="button" class="btn btn-info" @click="searchData">Run Report</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--<div class="text-right margin-bottom" v-if="cases.length">
                        <button class="btn btn-primary btn-generate-pdf">
                            <span>Export to PDF</span>
                            <span class="glyphicon glyphicon-download-alt" ></span>
                        </button>
                        <button class="btn btn-primary btn-generate-excel">
                            <span>Export to Excel</span>
                            <span class="glyphicon glyphicon-download-alt" ></span>
                        </button>
                    </div>-->

                    <div class="box box-info" id="pdf-box">
                        <div class="box-header with-border text-center">
                            <div class="box-title" th:text="${reportTitle}"></div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-bordered text-center" id="report-data">
                                <thead>
                                    <tr>
                                        <th>Sl.</th>
                                        <th>Branch Code</th>
                                        <th>Branch Name</th>
                                        <th>Ld Number</th>
                                        <th>CIF</th>
                                        <th>Accounts No</th>
                                        <th>Accounts Name</th>
                                        <th>Defendant/ Accused Name</th>
                                        <th>Defendant/ Accused Mobile#</th>
                                        <th>Segment</th>
                                        <th>Plaintiff Name</th>
                                        <th>Plaintiff Mobile</th>
                                        <th>Lawyer Name</th>
                                        <th>Lawyer Mobile No</th>
                                        <th>District Name</th>
                                        <th>Court Name</th>
                                        <th>Suit/Case Type</th>
                                        <th>Suit Number</th>
                                        <th>Date of filing</th>
                                        <th>Case Amount</th>
                                        <th>CL Status</th>
                                        <th>Total Recovery</th>
                                        <th>Outstanding</th>
                                        <th>Case Status</th>
                                        <th>Remarks</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="caseData in cases">
                                        <td>{{caseData.serial}}</td>
                                        <th>{{caseData.branchCode}}</th>
                                        <th>{{caseData.branchName}}</th>
                                        <th>{{caseData.ldNumber}}</th>
                                        <th>{{caseData.cif}}</th>
                                        <th>{{caseData.accountNo}}</th>
                                        <th>{{caseData.accountName}}</th>
                                        <th>{{caseData.defendantName}}</th>
                                        <th>{{caseData.defendantMobile}}</th>
                                        <th>{{caseData.segment}}</th>
                                        <th>{{caseData.plaintiffName}}</th>
                                        <th>{{caseData.plaintiffMobile}}</th>
                                        <th>{{caseData.lawyerName}}</th>
                                        <th>{{caseData.lawyerMobileNo}}</th>
                                        <th>{{caseData.districtName}}</th>
                                        <th>{{caseData.courtName}}</th>
                                        <th>{{caseData.caseType}}</th>
                                        <th>{{caseData.suitNumber}}</th>
                                        <th>{{formatDate(caseData.dateOfFiling)}}</th>
                                        <th>{{formatDecimal(caseData.caseAmount)}}</th>
                                        <th>{{caseData.clStatus}}</th>
                                        <th>{{formatDecimal(caseData.totalRecovery)}}</th>
                                        <th>{{formatDecimal(caseData.outstanding)}}</th>
                                        <th>{{caseData.caseStatus}}</th>
                                        <th>{{caseData.remarks}}</th>
                                    </tr>
                                </tbody>

                                <tfoot>
                                    <tr>
                                        <td></td>
                                        <th>Total</th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                        <th>{{formatDecimal(totalCaseAmount)}}</th>
                                        <th></th>
                                        <th>{{formatDecimal(totalRecovery)}}</th>
                                        <th>{{formatDecimal(totalOutstanding)}}</th>
                                        <th></th>
                                        <th></th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>

                <script>
                    pendingCourtCasesApp = new Vue({
                        el: '#pending-court-cases-app',
                        data: {
                            cases: [],
                            selectedMonth: '',
                            totalCaseAmount: 0,
                            totalRecovery: 0,
                            totalOutstanding: 0
                        },
                        methods: {
                            searchData: function () {
                                $.ajax({
                                    url: '/legal/report/monthly-new-case-filing/search?month='+this.selectedMonth,
                                    type: 'get',
                                    contentType: 'application/json;charset=UTF-8',
                                    success: function(response) {
                                        pendingCourtCasesApp.cases = response;

                                        pendingCourtCasesApp.totalCaseAmount= 0
                                        pendingCourtCasesApp.totalRecovery= 0
                                        pendingCourtCasesApp.totalOutstanding= 0

                                        pendingCourtCasesApp.getCalculateData()
                                    }
                                })
                            },
                            formatDate: function (data) {
                                if (data){
                                    var monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
                                    var fullDate = new Date(data);
                                    var date  = fullDate.getDate() < 10 ? '0' + fullDate.getDate() : fullDate.getDate();
                                    var month = fullDate.getMonth();


                                    return date + '-' + monthNames[month] + '-' + fullDate.getFullYear()
                                }
                            },
                            formatDecimal: function (data) {
                                if (Number(data)) {
                                    return data.toFixed(2)
                                }
                                else
                                    return '0.00'
                            },
                            getCalculateData: function () {
                                $.each(this.cases, function () {
                                    pendingCourtCasesApp.totalCaseAmount += Number(this.caseAmount)
                                    pendingCourtCasesApp.totalRecovery += Number(this.totalRecovery)
                                    pendingCourtCasesApp.totalOutstanding += Number(this.outstanding)
                                })
                            }
                        }
                    })

                    var table;
                    function initTable() {
                        table = $('#report-data').DataTable( {
                            dom: 'Bfrtip',
                            buttons: ['csv', 'excel', 'print']
                        });
                    }

                    $(document).ready(function () {
                        initTable();
                    })
                </script>
            </div>
        </div>
    </div>
</div>
</body>
</html>