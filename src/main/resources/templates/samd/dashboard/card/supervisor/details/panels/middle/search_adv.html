<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="ISO-8859-1"></meta>
    <title>Advanced Account Search </title>
</head>
<body>
<div id="layout-cibReport" th:fragment="search_test">
    <div class="csi-view-form-full-area csi-view-indtable">
        <div class="box-header with-border csi-view-box-header">
            <h3 class="box-title" >Advanced Account Search </h3>

        </div>
        <div class="box-body" >
            <section class="content" id="app">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="box">
                            <!-- /.box-header -->
                            <div class="box-body">
                                <form class="form-horizontal" style="background-color: rgb(233, 238, 243); padding: 15px;" method="post" id="advSearchForm" name="advSearchForm" action="">
                                    <div class="form-group" style="padding: 0px;margin-bottom:-5px;">
                                        <label style="background: yellow"  class="col-sm-2 custom-form-lebel-right">Card/Account No.</label>
                                        <div class="col-sm-2">
                                            <input v-model="accountNo" type="text" class="form-control input-sm" placeholder="Account No" id="accountNo" name="accountNo" />
                                        </div>
                                        <label style="background: yellow"  class="col-sm-2 custom-form-lebel-right">CIF No.</label>
                                        <div class="col-sm-2">
                                            <input v-model="cif" type="text" class="form-control input-sm" placeholder="CIF No." id="cifNo" name="cifNo" />
                                        </div>
                                        <label style="background: yellow" class="col-sm-2 custom-form-lebel-right">Customer Name</label>
                                        <div class="col-sm-2">
                                            <input v-model="customerName" type="text" class="form-control input-sm" placeholder="Customer Name" id="customerName" name="customerName" />
                                        </div>
                                    </div>

                                    <div class="form-group" style="padding: 0px;margin-bottom:-5px;">
                                        <label style="background: yellow" class="col-sm-2 custom-form-lebel-right">Mother's Name</label>
                                        <div class="col-sm-2">
                                            <input v-model="motherName" type="text" class="form-control input-sm" placeholder="Mother's Name" id="loan_motherName" name="motherName"/>
                                        </div>
                                        <label style="background: yellow" class="col-sm-2 custom-form-lebel-right">Mobile No.</label>
                                        <div class="col-sm-2">
                                            <input v-model="mobile" type="text" class="form-control input-sm" placeholder="Mobile No." id="loan_mobileNo" name="mobileNo" />
                                        </div>
                                        <label style="background: yellow" class="col-sm-2 custom-form-lebel-right">NID</label>
                                        <div class="col-sm-2">
                                            <input v-model="nationalId" type="text" class="form-control input-sm" placeholder="NID" id="nid" name="nid" />
                                        </div>
                                    </div>

                                    <div class="form-group" style="padding: 0px;margin-bottom:-5px;">

                                        <label style="background: yellow" class="col-sm-2 custom-form-lebel-right">DOB</label>
                                        <div class="col-sm-2">
                                            <input v-model="dateOfBirth" type="date" class="form-control input-sm" placeholder="Date of Birth" id="dobirth" name="dobirth" />
                                        </div>
                                        <label style="background: yellow" class="col-sm-2 custom-form-lebel-right">Email</label>
                                        <div class="col-sm-2">
                                            <input v-model="email" type="text" class="form-control input-sm" placeholder="Email Address" id="email" name="email" />
                                        </div>
                                        <label style="background: yellow" class="col-sm-2 custom-form-lebel-right">Passport No.</label>
                                        <div class="col-sm-2">
                                            <input v-model="passport" type="text" class="form-control input-sm" placeholder="Passport No." id="passportNo" name="passportNo" />
                                        </div>


                                    </div>

                                    <div class="form-group" style="padding: 0px;margin-bottom:-5px;">
                                        <label  class="col-sm-2 custom-form-lebel-right">Organization Name</label>
                                        <div class="col-sm-2">
                                            <input v-model="organization" type="text" class="form-control input-sm" placeholder="Organization Name" id="orgName" name="orgName" />
                                        </div>

                                        <label  class="col-sm-2 custom-form-lebel-right">Link Acc.</label>
                                        <div class="col-sm-2">
                                            <input v-model="linkAccount" type="text" class="form-control input-sm" placeholder="Link Acc." id="passportNo" name="passportNo" />
                                        </div>
                                        <label  class="col-sm-2 custom-form-lebel-right">Customer Id</label>
                                        <div class="col-sm-2">
                                            <input v-model="customerId" type="text" class="form-control input-sm" placeholder="Customer Id" id="dealerName" name="dealerName" />
                                        </div>
                                    </div>



                                    <div class="form-group" style="padding: 0px;margin-bottom:-5px;">
                                        <label  class="col-sm-2 custom-form-lebel-right">AutoDebit Acc</label>
                                        <div class="col-sm-2">
                                            <input v-model="autoDebit" type="text" class="form-control input-sm" placeholder="AutoDebit Acc" id="dealerName" name="dealerName" />
                                        </div>
                                        <label  class="col-sm-2 custom-form-lebel-right">Loan ID</label>
                                        <div class="col-sm-2">
                                            <input v-model="loanId" type="text" class="form-control input-sm" placeholder="Loan ID" id="dealerId" name="dealerId" />
                                        </div>
                                        <label  class="col-sm-2 custom-form-lebel-right">Cls Flag</label>
                                        <div class="col-sm-2">
                                            <input v-model="clsFlag" type="text" class="form-control input-sm" placeholder="Cls Flag" id="dealerId" name="dealerId" />
                                        </div>
                                    </div>

                                    <div class="form-group" style="padding: 0px;margin-bottom:-5px;">
                                        <label  class="col-sm-2 custom-form-lebel-right">Status</label>
                                        <div class="col-sm-2" style="margin-top: 3px;">
                                            <label>
                                                <input  v-model="active" name="removelines" type="radio" class ="cheker" autocomplete="off" v-bind:value="'Y'" checked>
                                                Active
                                            </label>
                                            <label>
                                                <input  v-model="active" name="removelines" type="radio" class ="cheker" v-bind:value="'N'">
                                                Close
                                            </label>
                                        </div>
                                    </div>

                                    <div class="col-sm-2 col-sm-offset-5" style="margin-top: 20px;margin-right: -31px;">
                                        <button @click.prevent="getCustomerResult" class="btn btn-success btn-sm btn-block pull-right" id="advCustSearchButton" name="advCustSearchButton">Search</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12">
                        <div class="box">
                            <div class="box-header with-border" style="text-align: center;">
                                <h1 class="box-title"><span style="padding: 10px;" class="label label-info">Customer Details Card</span></h1>
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">
                                <div v-show="cardTableShow" class="alert alert-danger" style="text-align: center">
                                    No records found on API
                                </div>
                                <table name="datatable-responsive"
                                       class="table table-striped table-bordered table-condensed"
                                       cellspacing="0" width="100%">
                                    <thead>
                                    <tr>
                                        <th>Card No</th>
                                        <th>Customer Name</th>
                                        <th>Customer Id</th>
                                        <th>CIF</th>
                                        <th>AutoDebit ACC.</th>
                                        <th>DOB</th>
                                        <th>Mobile</th>
                                        <th>Email </th>
                                        <th>Mother Name</th>
                                        <th>NID</th>
                                        <th>Organization Name</th>
                                        <th>OD/Min Due Amount</th>
                                        <th>Passport No</th>
                                        <th>Card Status</th>
                                    </tr>
                                    </thead>
                                    <tbody id="advCustSrcBody">
                                    <tr v-for="customer in cardCustomer">
                                        <td><a :href="'/profile/loanprofile/search?account='+ customer.cardNo" target="_blank">{{customer.cardNo}}</a></td>
                                        <td>{{customer.customerName}}</td>
                                        <td>{{customer.custId}}</td>
                                        <td>{{customer.cif}}</td>
                                        <td><a :href="'/profile/loanprofile/search?account='+ customer.autoDebitAccount" target="_blank">{{customer.autoDebitAccount}}</a></td>
                                        <td>{{customer.dob}}</td>
                                        <td>{{customer.mobileNo}}</td>
                                        <td>{{customer.Email}}</td>
                                        <td>{{customer.motherName}}</td>
                                        <td>{{customer.nid}}</td>
                                        <td>{{customer.organizationName}}</td>
                                        <td>{{customer.outstandingBalance}}</td>
                                        <td>{{customer.passportNo}}</td>
                                        <td>{{customer.cardStatus}}</td>
                                    </tr>
                                    </tbody>


                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12">
                        <div class="box">
                            <div class="box-header with-border" style="text-align: center;">
                                <h1 class="box-title"><span style="padding: 10px;" class="label label-primary">Customer Details Loan</span></h1>
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">
                                <div v-show="loanTableShow" class="alert alert-danger" style="text-align: center">
                                    No records found on API
                                </div>
                                <div style="overflow: auto;">
                                    <table name="datatable-responsive"
                                           class="table table-striped table-bordered table-condensed"
                                           cellspacing="0" width="100%">
                                        <thead>
                                        <tr>
                                            <th>Account No</th>
                                            <th>CIF</th>
                                            <th>Account Name</th>
                                            <th>DOB</th>
                                            <th>Mobile</th>
                                            <th>Outstanding</th>
                                            <th>Overdue</th>
                                            <th>Link/Proxy Acc.</th>
                                            <th>Mother name</th>
                                            <th>Email</th>
                                            <th>A/C Status</th>
                                            <th>NID</th>
                                            <th>Phone-1</th>
                                            <th>Phone-2</th>
                                        </tr>
                                        </thead>
                                        <tbody id="advCustSrcBody">
                                        <tr v-for="customer in loanCustomer">
                                            <td><a :href="'/profile/loanprofile/search?account='+ customer.foracid" target="_blank">{{customer.foracid}}</a></td>
                                            <td>{{customer.cifid}}</td>
                                            <td>{{customer.acctname}}</td>
                                            <td>{{customer.custdob | dateFormat}}</td>
                                            <td>{{customer.cellph1}}</td>
                                            <td>{{customer.clrbalamt | getAbsoluteValue}}</td>
                                            <td></td>
                                            <td><a :href="'/profile/loanprofile/search?account='+ customer.linkacct" target="_blank">{{customer.linkacct}}</a></td>
                                            <td>{{customer.mothername}}</td>
                                            <td>{{customer.email}}</td>
                                            <td>{{customer.acctclsflg}}</td>
                                            <td>{{customer.nid}}</td>
                                            <td>{{customer.communicationphn1}}</td>
                                            <td>{{customer.communicationphn2}}</td>
                                        </tr>
                                        </tbody>


                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </section>

            <script>
                new Vue({
                    el:'#app',
                    data:{
                        cardCustomer:[],
                        loanCustomer:[],

                        accountNo:"",
                        cif:"",
                        customerName:"",
                        motherName:"",
                        mobile:"",
                        nationalId:"",
                        dateOfBirth:"",
                        email:"",
                        passport:"",

                        autoDebit:"",
                        organization:"",
                        active:"Y",
                        customerId:"",

                        linkAccount:"",
                        loanId:"",
                        clsFlag:"",

                        loanTableShow:false,
                        cardTableShow:false,

                    },
                    filters:{
                        getAbsoluteValue:function(value){
                            return value < 0 ? value * -1: value;
                        },
                        dateFormat:function (value) {
                            var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                            ];
                            if(value != ''){
                                var date = new Date(value);
                                var day = date.getDate();
                                if(day < 10) day='0'+day;
                                return day +'-'+monthNames[date.getMonth()]+'-'+date.getFullYear().toString();
                            }else{
                                return "";
                            }
                        },
                    },
                    methods:{
                        getDateFormat(){
                            var dateArray = this.dateOfBirth.split('-');
                            var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                            ];

                            return dateArray[2] +"/"+monthNames[dateArray[1] - 1]+"/"+dateArray[0];
                        },
                        getCustomerResult: function () {
                            var host = window.location.host;

                            var accNo = this.accountNo;
                            var cif = this.cif;
                            var cusName =  this.customerName;
                            var mothName = this.motherName;
                            var mob = this.mobile;
                            var nanId = this.nationalId;
                            var dob = "";
                            if(this.dateOfBirth != '') dob = this.getDateFormat();
                            else dob = "";
                            var emi = this.email;
                            var pass = this.passport;

                            var ac = this.active;
                            var org = this.organization;
                            var autoDebit = this.autoDebit;
                            var cusId = this.customerId;

                            var linkAccount = this.linkAccount;
                            var loanId =  this.loanId;
                            var clsFlag =  this.clsFlag;

                            var url = 'https://'+host+'/api/soap/customerSearch?accountNumber='+accNo+ '&CIF='+cif+'&AutoDebitAccount='+autoDebit+'&CustId='+cusId+
                                '&MobileNo='+mob+'&NID='+nanId+'&CustomerName='+cusName+'&MotherName='+mothName+'&DOB='+dob+
                                '&OrganizationName='+org+'&EmailAddress='+emi+'&PassportNo='+pass+'&Status='+ac;

                            this.$http.get(url,
                                {credentials : true, headers:{
                                        'X-CSRF-TOKEN' : window.csrfToken,
                                    }}).then(res => {
                                console.log(res);
                                if(res.body){
                                    this.cardCustomer = res.body.customerInfo;
                                    if(this.cardCustomer.length > 0) this.cardTableShow = false;
                                    else this.cardTableShow = true;
                                }
                            }).catch(err => {
                                console.log(err);
                            })

                            var url = 'https://'+host+'/api/soap/getLoanSearchInfo?accNo='+accNo+ '&custId='+cif+'&linkAccount='+linkAccount+
                                '&phoneNo='+mob+'&nid='+nanId+'&custName='+cusName+'&mothername='+mothName+'&dob='+dob+
                                '&clsFlag='+clsFlag+'&email='+emi+'&passport='+pass+'&loanId='+loanId;

                            this.$http.get(url,
                                {credentials : true, headers:{
                                        'X-CSRF-TOKEN' : window.csrfToken,
                                    }}).then(res => {
                                console.log(res);
                                if(res.body){
                                    this.loanCustomer = res.body.responseDetails;
                                    if(this.loanCustomer.length > 0) this.loanTableShow = false;
                                    else this.loanTableShow = true;
                                }
                            }).catch(err => {
                                console.log(err);
                            })
                        }
                    }
                })
            </script>
        </div>
    </div>


</div>
</body>


</html>
